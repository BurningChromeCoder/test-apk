<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MiPuerta</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            color: white;
        }
        .card {
            text-align: center;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            max-width: 400px;
        }
        .icon { 
            font-size: 100px; 
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        h1 { font-size: 28px; margin-bottom: 10px; }
        p { opacity: 0.9; font-size: 16px; }
        #jitsi { display: none; }
    </style>
</head>
<body>
    <div class="card" id="ui">
        <div class="icon">ðŸ“ž</div>
        <h1>Conectando...</h1>
        <p>Iniciando llamada de audio</p>
    </div>
    <div id="jitsi"></div>
    
    <script src='https://meet.jit.si/external_api.js'></script>
    <script>
        const params = new URLSearchParams(window.location.search);
        const sala = params.get('sala') || 'puerta-principal-test';
        
        console.log('Conectando a sala:', sala);
        
        // Conectar solo audio (sin video)
        const api = new JitsiMeetExternalAPI("meet.jit.si", {
            roomName: sala,
            parentNode: document.querySelector('#jitsi'),
            width: '100%',
            height: '100%',
            configOverrides: {
                startWithAudioMuted: false,
                startWithVideoMuted: true,
                prejoinPageEnabled: false,
                requireDisplayName: false,
                disableDeepLinking: true
            },
            interfaceConfigOverrides: {
                TOOLBAR_BUTTONS: ['microphone', 'hangup'],
                SHOW_JITSI_WATERMARK: false,
                SHOW_WATERMARK_FOR_GUESTS: false
            },
            userInfo: {
                displayName: 'Usuario'
            }
        });
        
        api.addEventListener('videoConferenceJoined', () => {
            console.log('Conectado exitosamente');
            document.querySelector('.card h1').textContent = 'âœ… Conectado';
            document.querySelector('.card p').textContent = 'Llamada de audio activa';
            document.querySelector('.icon').textContent = 'ðŸ”Š';
        });
        
        api.addEventListener('readyToClose', () => {
            document.querySelector('.card h1').textContent = 'Llamada finalizada';
            document.querySelector('.card p').textContent = 'Puedes cerrar la app';
            document.querySelector('.icon').textContent = 'ðŸ‘‹';
        });
    </script>
</body>
</html>

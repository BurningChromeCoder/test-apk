name: Build APK v2

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    timeout-minutes: 15
    
    steps:
    - uses: actions/checkout@v4
    
    - uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'npm'
    
    - uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '21'
    
    - name: Verify Java version
      run: java -version
    
    - name: Setup project
      run: |
        # Crear package.json
        cat > package.json << 'EOF'
        {
          "name": "mipuerta-app",
          "version": "1.0.0",
          "description": "App de puerta"
        }
        EOF
        
        # Verificar o crear www/
        mkdir -p www
        if [ ! -f "www/index.html" ]; then
          cat > www/index.html << 'EOF'
        <!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>MiPuerta</title>
        </head>
        <body>
            <h1>ðŸšª MiPuerta</h1>
            <p>App compilada exitosamente</p>
        </body>
        </html>
        EOF
        fi
        
        # Mostrar estructura
        echo "=== Estructura del proyecto ==="
        ls -la
        echo "=== Contenido de www/ ==="
        ls -la www/
    
    - name: Install Capacitor
      run: |
        npm install -g @capacitor/cli
        npm install @capacitor/core @capacitor/android
    
    - name: Initialize Capacitor
      run: |
        npx cap init MiPuerta com.mipuerta.app --web-dir=www
        echo "=== Capacitor inicializado ==="
        cat capacitor.config.json
    
    - name: Add Android
      run: npx cap add android
    
    - name: Sync
      run: npx cap sync
    
    - name: Build APK
      run: |
        cd android
        chmod +x gradlew
        ./gradlew assembleDebug --no-daemon --stacktrace --info
    
    - name: Upload APK
      uses: actions/upload-artifact@v4
      with:
        name: mipuerta-apk-${{ github.run_number }}
        path: android/app/build/outputs/apk/debug/app-debug.apk
        if-no-files-found: error
```

---

## **VerificaciÃ³n rÃ¡pida:**

DespuÃ©s de ejecutar el workflow, deberÃ­as ver:
```
âœ… Setup Java 21
âœ… Install Capacitor
âœ… Initialize Capacitor
âœ… Add Android platform
âœ… Sync files
âœ… Build APK
âœ… Upload APK

Artifacts: mipuerta-apk-XX
